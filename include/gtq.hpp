/**********************************************************************************************************************************
                                            Monomial's Library by Tiago Fernandes Moherdaui

            The library is meant to make operations with monomials easier by use of indicial notation.

            This file provides Gauss-Legendre quadrature pairs (pos0, pos1, weight) for triangular domains for order up to 14.

                    Positions in [0,1] and weights in [0,1]            mnl::GaussLegendreTriangle(k);
                    Third position is always pos2 = 1. - pos0 - pos1.

            This is produced in C++11 and includes only <array> and <vector>.

**********************************************************************************************************************************/

#pragma once
#ifndef GTQ
#define GTQ

#include <vector>
#include <array>
namespace mnl {
    using monOrder = int;

    constexpr std::array<double, 171> _triangleclut{
        0.166666666666667, 0.166666666666667, 0.333333333333333,
        0.445948490915965, 0.445948490915965, 0.223381589678011,
        0.0915762135097707, 0.0915762135097707, 0.109951743655322,
        0.1012865073235, 0.1012865073235, 0.1259391805448,
        0.4701420641051, 0.4701420641051, 0.1323941527885,
        0.0651301029022, 0.0651301029022, 0.0533472356088,
        0.6384441885698, 0.3128654960049, 0.0771137608903,
        0.260345966079, 0.260345966079, 0.1756152574332,
        0.17056930775176, 0.17056930775176, 0.103217370534718,
        0.459292588292723, 0.459292588292723, 0.0950916342672848,
        0.0505472283170309, 0.0505472283170309, 0.0324584976231981,
        0.728492392955404, 0.263112829634638, 0.027230314174435,
        0.489682519198738, 0.489682519198738, 0.0313347002271391,
        0.188203535619033, 0.188203535619033, 0.0796477389272105,
        0.741198598784498, 0.221962989160766, 0.0432835393772894,
        0.437089591492937, 0.437089591492937, 0.0778275410047742,
        0.0447295133944525, 0.0447295133944525, 0.0255776756586981,
        0.497865432954475, 0.497865432954475, 0.00722985059205674,
        0.428012449729056, 0.428012449729056, 0.0744921779209805,
        0.184756412743225, 0.184756412743225, 0.0786464734031085,
        0.020481218571678, 0.020481218571678, 0.0069283230871075,
        0.828423433846694, 0.136573576256033, 0.0295183203347794,
        0.629707329152919, 0.332743600588639, 0.0395793671960612,
        0.0308468956355867, 0.0308468956355867, 0.012249296950708,
        0.498780165178461, 0.498780165178461, 0.0124654918738814,
        0.826329717592751, 0.159303619837694, 0.0145576233378092,
        0.113207827286694, 0.113207827286694, 0.0401292423813083,
        0.436655016393176, 0.436655016393176, 0.0630948721598989,
        0.214483458619269, 0.214483458619269, 0.0678451077436953,
        0.641704716714386, 0.310631216313463, 0.0406428486558865,
        0.271462507014926, 0.271462507014926, 0.0625412131959029,
        0.109257827659354, 0.109257827659354, 0.0284860520688775,
        0.440111648658593, 0.440111648658593, 0.0499183349280609,
        0.628249751683556, 0.255454228638517, 0.0432273636594142,
        0.851337792510241, 0.127279717233589, 0.0150836775765114,
        0.685310163906392, 0.291655679738341, 0.0217835850386075,
        0.488203750945542, 0.488203750945542, 0.024266838081452,
        0.0246463634363354, 0.0246463634363354, 0.00793164250997365,
        0.496135894741046, 0.496135894741046, 0.0099414763610726,
        0.469608689653492, 0.469608689653492, 0.0327812416037229,
        0.231110284949082, 0.231110284949082, 0.0460624095927783,
        0.688933307039605, 0.292078688576637, 0.0181254986462009,
        0.635518715623632, 0.266745253310351, 0.0372119604572616,
        0.414477570279054, 0.414477570279054, 0.0469470955421552,
        0.113559912572133, 0.113559912572133, 0.0309030979757598,
        0.851233880009634, 0.126799775783837, 0.0153930726837822,
        0.0248959314912164, 0.0248959314912164, 0.00802939979525841,
        0.417644719340454, 0.417644719340454, 0.0327883535441254,
        0.686980167808088, 0.298372882136258, 0.0144363081135338,
        0.0617998830908725, 0.0617998830908725, 0.0144336996697767,
        0.570222290846683, 0.336861459796345, 0.0385715107870607,
        0.273477528308839, 0.273477528308839, 0.0517741045072916,
        0.177205532412543, 0.177205532412543, 0.0421625887369931,
        0.0193909612487018, 0.0193909612487018, 0.00492340360240009,
        0.488963910362179, 0.488963910362179, 0.0218835813694289,
        0.770608554774997, 0.172266687821355, 0.0246657532125637,
        0.879757171370171, 0.118974497696957, 0.00501022883850067
    };
    constexpr std::array<size_t, 15> _startingIndexPerOrder{
        0, 0, 0, 1, 1, 3, 5, 5, 8, 12, 17, 23, 30, 38, 47
    };
    constexpr std::array<size_t, 15> _nQuadraturePointsPerOrder{
        1, 1, 3, 6, 6, 7, 13, 13, 16, 19, 25, 28, 33, 37, 42
    };

    inline const std::vector<std::array<double, 3>> GaussLegendreTriangle(const monOrder k) {
        // Only available up to k = 14.
        if (k > 14)
            return {};
        
        std::vector<std::array<double, 3>> out;
        const size_t nPoints = _nQuadraturePointsPerOrder[(size_t)k];
        
        // Extract points from look-up table.
        double totalWeight = 0.0;
        size_t currentIndex = _startingIndexPerOrder[(size_t)k];
        constexpr double tol = 1e-8;
        while (nPoints - int(out.size()) > 2){
            const double xi0 = _triangleclut[3 * currentIndex];
            const double xi1 = _triangleclut[3 * currentIndex + 1];
            const double xi2 = 1. - xi0 - xi1;
            const double weight = _triangleclut[3 * currentIndex + 2];
            out.push_back({xi2, xi0, weight});
            out.push_back({xi0, xi2, weight});
            out.push_back({xi0, xi1, weight});
            totalWeight += 3 * weight;
            if (xi0 - xi1 > tol) { // 6-symmetry
                out.push_back({xi2, xi1, weight});
                out.push_back({xi1, xi2, weight});
                out.push_back({xi1, xi0, weight});
                totalWeight += 3 * weight;
            }
            ++currentIndex;
        }
        
        if (nPoints % 3)
            out.push_back({.333333333333333, .333333333333333, 1. - totalWeight});

        return out;
    }
}

#endif